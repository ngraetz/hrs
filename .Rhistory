col_order <- c(col_order, grep(v, names(table1), value = T))
}
setcolorder(table1, c('metro_region','nmx_2000','nmx_2015','nmx_change',col_order))
names(table1)
repo <- 'C:/Users/ngraetz/Documents/repos/rwjf_counties/'
source(paste0(repo, 'functions.R'))
source(paste0(repo, 'functions_shapley.R'))
cov_names <- get_clean_cov_names()
setnames(cov_names,'fe','name')
table1 <- fread('C:/Users/ngraetz/Desktop/feb25_tables/table1.csv')
# for(v in grep('_2015',names(table1),value = T)) {
#   message(v)
#   print(summary(table1[, get(v)]))
# }
vars_to_scale <- c('chr_diabetes_monitoring','chr_mammography','perc_black','perc_hispanic','percent_transfers')
for(v in vars_to_scale) {
vars <- grep(v,names(table1),value=T)
for(var in vars) table1[, (var) := get(var) * 100]
}
vars <- grep('nmx',names(table1),value=T)
for(var in vars) table1[, (var) := get(var) * 100000]
table_names <- unique(gsub('_2000|_2015|_change', '', names(table1)))
cov_names <- cov_names[name %in% table_names, ]
col_order <- c()
for(v in cov_names[, name]) {
col_order <- c(col_order, grep(v, names(table1), value = T))
}
table1[, metro_region := paste0(metroname, '_', regionname)]
setcolorder(table1, c('metro_region','nmx_2000','nmx_2015','nmx_change',col_order))
table1 <- table1[order(metro_region)]
table1[, metro_region := gsub('Lg central metro_|Lg fringe metro_|Md/Sm metro_|Nonmetro_', '', metro_region)]
names(table1)
exp(table1$log_mds_pc_2015)
table1 <- fread('C:/Users/ngraetz/Desktop/feb25_tables/table1.csv')
# for(v in grep('_2015',names(table1),value = T)) {
#   message(v)
#   print(summary(table1[, get(v)]))
# }
vars_to_scale <- c('chr_diabetes_monitoring','chr_mammography','perc_black','perc_hispanic','percent_transfers')
for(v in vars_to_scale) {
vars <- grep(v,names(table1),value=T)
for(var in vars) table1[, (var) := get(var) * 100]
}
mdvars <- grep('mds',names(table1),value=T)
for(var in mdvars) table1[, (var) := round(exp(get(var)),1)]
vars <- grep('nmx',names(table1),value=T)
for(var in vars) table1[, (var) := round(get(var) * 100000)]
table_names <- unique(gsub('_2000|_2015|_change', '', names(table1)))
cov_names <- cov_names[name %in% table_names, ]
col_order <- c()
for(v in cov_names[, name]) {
col_order <- c(col_order, grep(v, names(table1), value = T))
}
table1[, metro_region := paste0(metroname, '_', regionname)]
setcolorder(table1, c('metro_region','nmx_2000','nmx_2015','nmx_change',col_order))
table1 <- table1[order(metro_region)]
table1[, metro_region := gsub('Lg central metro_|Lg fringe metro_|Md/Sm metro_|Nonmetro_', '', metro_region)]
setnames(table1, grep('_2000', names(table1), value=T), rep('2000',14))
setnames(table1, grep('_2015', names(table1), value=T), rep('2015',14))
#setnames(table1, grep('_change', names(table1), value=T), rep('Change',14))
for(v in grep('_change',names(table1),value=T)) table1[, (v) := NULL]
table1[, V1 := NULL]
table1[, metroname := NULL]
table1[, regionname := NULL]
setnames(table1, 'metro_region', '')
for(v in names(table1)) {
table1[, (v) := as.character(get(v))]
table1[nchar(get(v))==3, paste0('',get(v))]
}
names(table1)
for(v in names(table1)) {
table1[, (v) := as.character(get(v))]
}
names(table1)
table1 <- fread('C:/Users/ngraetz/Desktop/feb25_tables/table1.csv')
# for(v in grep('_2015',names(table1),value = T)) {
#   message(v)
#   print(summary(table1[, get(v)]))
# }
vars_to_scale <- c('chr_diabetes_monitoring','chr_mammography','perc_black','perc_hispanic','percent_transfers')
for(v in vars_to_scale) {
vars <- grep(v,names(table1),value=T)
for(var in vars) table1[, (var) := get(var) * 100]
}
mdvars <- grep('mds',names(table1),value=T)
for(var in mdvars) table1[, (var) := round(exp(get(var)),1)]
vars <- grep('nmx',names(table1),value=T)
for(var in vars) table1[, (var) := round(get(var) * 100000)]
table_names <- unique(gsub('_2000|_2015|_change', '', names(table1)))
table_names
table1 <- fread('C:/Users/ngraetz/Desktop/feb25_tables/table1.csv')
# for(v in grep('_2015',names(table1),value = T)) {
#   message(v)
#   print(summary(table1[, get(v)]))
# }
vars_to_scale <- c('chr_diabetes_monitoring','chr_mammography','perc_black','perc_hispanic','percent_transfers')
for(v in vars_to_scale) {
vars <- grep(v,names(table1),value=T)
for(var in vars) table1[, (var) := get(var) * 100]
}
mdvars <- grep('mds',names(table1),value=T)
for(var in mdvars) table1[, (var) := round(exp(get(var)),1)]
vars <- grep('nmx',names(table1),value=T)
for(var in vars) table1[, (var) := round(get(var) * 100000)]
names(table1)
head(table1)
for(v in grep('_2000|_2015|_change', names(table1), value = T)) {
table1[, (v) := as.character(round(get(v),2))]
}
table1[, (v) := as.character(round(get(v),2))]
head(table1)
table1 <- fread('C:/Users/ngraetz/Desktop/feb25_tables/table1.csv')
# for(v in grep('_2015',names(table1),value = T)) {
#   message(v)
#   print(summary(table1[, get(v)]))
# }
vars_to_scale <- c('chr_diabetes_monitoring','chr_mammography','perc_black','perc_hispanic','percent_transfers')
for(v in vars_to_scale) {
vars <- grep(v,names(table1),value=T)
for(var in vars) table1[, (var) := get(var) * 100]
}
mdvars <- grep('mds',names(table1),value=T)
for(var in mdvars) table1[, (var) := round(exp(get(var)),1)]
vars <- grep('nmx',names(table1),value=T)
for(var in vars) table1[, (var) := round(get(var) * 100000)]
for(v in grep('_2000|_2015|_change', names(table1), value = T)) {
table1[, (v) := as.character(round(get(v),1))]
}
head(table1)
table1[!grep('[.]',log_mds_pc_2000), log_mds_pc_2000]
table1[!grep('[.]',log_mds_pc_2000), ]
table1[!grep('[.]',log_mds_pc_2000), ]
table1 <- fread('C:/Users/ngraetz/Desktop/feb25_tables/table1.csv')
# for(v in grep('_2015',names(table1),value = T)) {
#   message(v)
#   print(summary(table1[, get(v)]))
# }
vars_to_scale <- c('chr_diabetes_monitoring','chr_mammography','perc_black','perc_hispanic','percent_transfers')
for(v in vars_to_scale) {
vars <- grep(v,names(table1),value=T)
for(var in vars) table1[, (var) := get(var) * 100]
}
mdvars <- grep('mds',names(table1),value=T)
for(var in mdvars) table1[, (var) := round(exp(get(var)),1)]
vars <- grep('nmx',names(table1),value=T)
for(var in vars) table1[, (var) := round(get(var) * 100000)]
for(v in grep('_2000|_2015|_change', names(table1), value = T)) {
table1[, (v) := as.character(round(get(v),1))]
table1[!grep('[.]',get(v)), (v) := paste0(get(v), '.0')]
table1[nchar(get(v))==3, (v) := paste0(' ',get(v))]
}
View(table1)
table1[nchar(as_heavy_drinking_prev_2000)==3,]
head(table1)
head(table1$as_heavy_drinking_prev_2000)
dim(table1)
table1 <- fread('C:/Users/ngraetz/Desktop/feb25_tables/table1.csv')
# for(v in grep('_2015',names(table1),value = T)) {
#   message(v)
#   print(summary(table1[, get(v)]))
# }
vars_to_scale <- c('chr_diabetes_monitoring','chr_mammography','perc_black','perc_hispanic','percent_transfers')
for(v in vars_to_scale) {
vars <- grep(v,names(table1),value=T)
for(var in vars) table1[, (var) := get(var) * 100]
}
mdvars <- grep('mds',names(table1),value=T)
for(var in mdvars) table1[, (var) := round(exp(get(var)),1)]
vars <- grep('nmx',names(table1),value=T)
for(var in vars) table1[, (var) := round(get(var) * 100000)]
for(v in grep('_2000|_2015|_change', names(table1), value = T)) {
table1[, (v) := as.character(round(get(v),1))]
table1[!grep('[.]',get(v)), (v) := paste0(get(v), '.0')]
table1[nchar(get(v))==3, (v) := paste0(' ',get(v))]
}
table_names <- unique(gsub('_2000|_2015|_change', '', names(table1)))
cov_names <- cov_names[name %in% table_names, ]
col_order <- c()
for(v in cov_names[, name]) {
col_order <- c(col_order, grep(v, names(table1), value = T))
}
table1[, metro_region := paste0(metroname, '_', regionname)]
setcolorder(table1, c('metro_region','nmx_2000','nmx_2015','nmx_change',col_order))
table1 <- table1[order(metro_region)]
table1[, metro_region := gsub('Lg central metro_|Lg fringe metro_|Md/Sm metro_|Nonmetro_', '', metro_region)]
setnames(table1, grep('_2000', names(table1), value=T), rep('2000',14))
setnames(table1, grep('_2015', names(table1), value=T), rep('2015',14))
#setnames(table1, grep('_change', names(table1), value=T), rep('Change',14))
for(v in grep('_change',names(table1),value=T)) table1[, (v) := NULL]
table1[, V1 := NULL]
table1[, metroname := NULL]
table1[, regionname := NULL]
setnames(table1, 'metro_region', '')
dim(table1)
repo <- 'C:/Users/ngraetz/Documents/repos/rwjf_counties/'
source(paste0(repo, 'functions.R'))
source(paste0(repo, 'functions_shapley.R'))
cov_names <- get_clean_cov_names()
setnames(cov_names,'fe','name')
table1 <- fread('C:/Users/ngraetz/Desktop/feb25_tables/table1.csv')
# for(v in grep('_2015',names(table1),value = T)) {
#   message(v)
#   print(summary(table1[, get(v)]))
# }
vars_to_scale <- c('chr_diabetes_monitoring','chr_mammography','perc_black','perc_hispanic','percent_transfers')
for(v in vars_to_scale) {
vars <- grep(v,names(table1),value=T)
for(var in vars) table1[, (var) := get(var) * 100]
}
mdvars <- grep('mds',names(table1),value=T)
for(var in mdvars) table1[, (var) := round(exp(get(var)),1)]
vars <- grep('nmx',names(table1),value=T)
for(var in vars) table1[, (var) := as.character(round(get(var) * 100000))]
grep('_2000|_2015|_change', names(table1), value = T)
v <- 'nmx_change'
!grep('nmx',v)
for(v in grep('_2000|_2015|_change', names(table1), value = T)) {
if(!grep('nmx',v)) {
table1[, (v) := as.character(round(get(v),1))]
table1[!grep('[.]',get(v)), (v) := paste0(get(v), '.0')]
#table1[nchar(get(v))==3, (v) := paste0(' ',get(v))]
}
}
for(v in grep('_2000|_2015|_change', names(table1), value = T)) {
message(v)
if(!grep('nmx',v)) {
table1[, (v) := as.character(round(get(v),1))]
table1[!grep('[.]',get(v)), (v) := paste0(get(v), '.0')]
#table1[nchar(get(v))==3, (v) := paste0(' ',get(v))]
}
}
v <- 'as_heavy_drinking_prev_2000'
!grep('nmx',v)
!grepl('nmx',v)
repo <- 'C:/Users/ngraetz/Documents/repos/rwjf_counties/'
source(paste0(repo, 'functions.R'))
source(paste0(repo, 'functions_shapley.R'))
cov_names <- get_clean_cov_names()
setnames(cov_names,'fe','name')
table1 <- fread('C:/Users/ngraetz/Desktop/feb25_tables/table1.csv')
# for(v in grep('_2015',names(table1),value = T)) {
#   message(v)
#   print(summary(table1[, get(v)]))
# }
vars_to_scale <- c('chr_diabetes_monitoring','chr_mammography','perc_black','perc_hispanic','percent_transfers')
for(v in vars_to_scale) {
vars <- grep(v,names(table1),value=T)
for(var in vars) table1[, (var) := get(var) * 100]
}
mdvars <- grep('mds',names(table1),value=T)
for(var in mdvars) table1[, (var) := round(exp(get(var)),1)]
vars <- grep('nmx',names(table1),value=T)
for(var in vars) table1[, (var) := as.character(round(get(var) * 100000))]
for(v in grep('_2000|_2015|_change', names(table1), value = T)) {
message(v)
if(!grepl('nmx',v)) {
table1[, (v) := as.character(round(get(v),1))]
table1[!grep('[.]',get(v)), (v) := paste0(get(v), '.0')]
table1[nchar(get(v))==3, (v) := paste0(' ',get(v))]
}
}
table_names <- unique(gsub('_2000|_2015|_change', '', names(table1)))
cov_names <- cov_names[name %in% table_names, ]
col_order <- c()
for(v in cov_names[, name]) {
col_order <- c(col_order, grep(v, names(table1), value = T))
}
table1[, metro_region := paste0(metroname, '_', regionname)]
setcolorder(table1, c('metro_region','nmx_2000','nmx_2015','nmx_change',col_order))
table1 <- table1[order(metro_region)]
table1[, metro_region := gsub('Lg central metro_|Lg fringe metro_|Md/Sm metro_|Nonmetro_', '', metro_region)]
setnames(table1, grep('_2000', names(table1), value=T), rep('2000',14))
setnames(table1, grep('_2015', names(table1), value=T), rep('2015',14))
#setnames(table1, grep('_change', names(table1), value=T), rep('Change',14))
for(v in grep('_change',names(table1),value=T)) table1[, (v) := NULL]
table1[, V1 := NULL]
table1[, metroname := NULL]
table1[, regionname := NULL]
setnames(table1, 'metro_region', '')
head(table1)
repo <- 'C:/Users/ngraetz/Documents/repos/rwjf_counties/'
source(paste0(repo, 'functions.R'))
source(paste0(repo, 'functions_shapley.R'))
cov_names <- get_clean_cov_names()
setnames(cov_names,'fe','cov')
## DECOMPOSITION RESULTS
dc <- fread("C:/Users/ngraetz/Desktop/feb25_tables/allcause_25_64_decomp.csv")
dc[, metro_region := paste0(metroname, ' ', regionname)]
names(dc)
dc <- fread("C:/Users/ngraetz/Desktop/feb25_tables/allcause_25_64_decomp.csv")
dc[, V1 := NULL]
dc <- dc[, c('metro_region','contribution_mort','cov_name')]
head(dc)
dc[, cov_name := factor(cov_name, levels = ordered_covs)]
hist(dc$contribution_mort)
ggplot() +
geom_tile(data=dc,
aes(x=cov_name,
y=metro_region,
fill=contribution_mort),
color='black') +
geom_text(data=dc,
aes(x=cov_name,
y=metro_region,
label=round(contribution_mort,1))) +
scale_fill_distiller(palette = 'RdBu', type='div', limits=c(-20,20), name='Change in ASDR') +
labs(x='',y='') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot() +
geom_tile(data=dc,
aes(x=cov_name,
y=metro_region,
fill=contribution_mort),
color='black') +
geom_text(data=dc,
aes(x=cov_name,
y=metro_region,
label=round(contribution_mort,1))) +
scale_fill_distiller(palette = 'RdBu', type='div', limits=c(-30,30), name='Change in ASDR') +
labs(x='',y='') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot() +
geom_tile(data=dc,
aes(x=cov_name,
y=metro_region,
fill=contribution_mort),
color='black') +
geom_text(data=dc,
aes(x=cov_name,
y=metro_region,
label=round(contribution_mort,1))) +
scale_fill_distiller(palette = 'RdBu', type='div', limits=c(-10,10), name='Change in ASDR') +
labs(x='',y='') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot() +
geom_tile(data=dc,
aes(x=cov_name,
y=metro_region,
fill=contribution_mort),
color='black') +
geom_text(data=dc,
aes(x=cov_name,
y=metro_region,
label=round(contribution_mort,1))) +
scale_fill_distiller(palette = 'RdYlBu', type='div', limits=c(-20,20), name='Change in ASDR') +
labs(x='',y='') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
dc <- fread("C:/Users/ngraetz/Desktop/feb25_tables/allcause_25_64_decomp.csv")
dc[, V1 := NULL]
dc <- dc[, c('metro_region','contribution_mort','cov_name')]
dc[, cov_name := factor(cov_name, levels = ordered_covs)]
dc_capped <- copy(dc)
dc_capped[contribution_mort >= 20, change := 20]
dc_capped[contribution_mort <= -20, change := -20]
ggplot() +
geom_tile(data=dc,
aes(x=cov_name,
y=metro_region,
fill=contribution_mort),
color='black') +
geom_text(data=dc,
aes(x=cov_name,
y=metro_region,
label=round(contribution_mort,1))) +
scale_fill_distiller(palette = 'RdBu', type='div', limits=c(-20,20), name='Change in ASDR') +
labs(x='',y='') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
ggplot() +
geom_tile(data=dc_capped,
aes(x=cov_name,
y=metro_region,
fill=contribution_mort),
color='black') +
geom_text(data=dc,
aes(x=cov_name,
y=metro_region,
label=round(contribution_mort,1))) +
scale_fill_distiller(palette = 'RdBu', type='div', limits=c(-20,20), name='Change in ASDR') +
labs(x='',y='') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
dc_capped
dc_capped[contribution_mort >= 20, contribution_mort := 20]
dc_capped[contribution_mort <= -20, contribution_mort := -20]
ggplot() +
geom_tile(data=dc_capped,
aes(x=cov_name,
y=metro_region,
fill=contribution_mort),
color='black') +
geom_text(data=dc,
aes(x=cov_name,
y=metro_region,
label=round(contribution_mort,1))) +
scale_fill_distiller(palette = 'RdBu', type='div', limits=c(-20,20), name='Change in ASDR') +
labs(x='',y='') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
pdf('C:/Users/ngraetz/Documents/repos/rwjf_counties/decomp_results.pdf', width=12, height=12)
ggplot() +
geom_tile(data=dc_capped,
aes(x=cov_name,
y=metro_region,
fill=contribution_mort),
color='black') +
geom_text(data=dc,
aes(x=cov_name,
y=metro_region,
label=round(contribution_mort,1))) +
scale_fill_distiller(palette = 'RdBu', type='div', limits=c(-20,20), name='Change in ASDR') +
labs(x='',y='') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
dev.off()
dc <- fread("C:/Users/ngraetz/Desktop/feb25_tables/allcause_25_64_decomp.csv")
dc[, V1 := NULL]
dc <- dc[, c('metro_region','contribution_mort','cov_name')]
dc[, cov_name := factor(cov_name, levels = ordered_covs)]
dc_capped <- copy(dc)
dc_capped[contribution_mort >= 20, contribution_mort := 20]
dc_capped[contribution_mort <= -20, contribution_mort := -20]
dc_capped
dc <- fread("C:/Users/ngraetz/Desktop/feb25_tables/allcause_25_64_decomp.csv")
dc[, V1 := NULL]
dc <- dc[, c('metro_region','contribution_mort','cov_name')]
## DECOMPOSITION RESULTS
dc <- fread("C:/Users/ngraetz/Desktop/feb25_tables/allcause_25_64_decomp.csv")
unique(dc$fe)
ordered_covs
dc <- fread("C:/Users/ngraetz/Desktop/feb25_tables/allcause_25_64_decomp.csv")
dc[, V1 := NULL]
dc[fe=='residual', cov_name := 'Residual']
dc[fe=='year', cov_name := 'Year']
dc <- dc[, c('metro_region','contribution_mort','cov_name')]
ordered_covs_dc <- c(ordered_covs, 'Year', 'Residual')
dc[, cov_name := factor(cov_name, levels = ordered_covs)]
dc_capped <- copy(dc)
dc_capped[contribution_mort >= 20, contribution_mort := 20]
dc_capped[contribution_mort <= -20, contribution_mort := -20]
pdf('C:/Users/ngraetz/Documents/repos/rwjf_counties/decomp_results.pdf', width=12, height=12)
ggplot() +
geom_tile(data=dc_capped,
aes(x=cov_name,
y=metro_region,
fill=contribution_mort),
color='black') +
geom_text(data=dc,
aes(x=cov_name,
y=metro_region,
label=round(contribution_mort,1))) +
scale_fill_distiller(palette = 'RdBu', type='div', limits=c(-20,20), name='Change in ASDR') +
labs(x='',y='') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
dev.off()
dc <- fread("C:/Users/ngraetz/Desktop/feb25_tables/allcause_25_64_decomp.csv")
dc[, V1 := NULL]
dc[fe=='residual', cov_name := 'Residual']
dc[fe=='year', cov_name := 'Year']
dc <- dc[, c('metro_region','contribution_mort','cov_name')]
ordered_covs_dc <- c(ordered_covs, 'Year', 'Residual')
dc[, cov_name := factor(cov_name, levels = ordered_covs_dc)]
dc_capped <- copy(dc)
dc_capped[contribution_mort >= 20, contribution_mort := 20]
dc_capped[contribution_mort <= -20, contribution_mort := -20]
pdf('C:/Users/ngraetz/Documents/repos/rwjf_counties/decomp_results.pdf', width=12, height=12)
ggplot() +
geom_tile(data=dc_capped,
aes(x=cov_name,
y=metro_region,
fill=contribution_mort),
color='black') +
geom_text(data=dc,
aes(x=cov_name,
y=metro_region,
label=round(contribution_mort,1))) +
scale_fill_distiller(palette = 'RdBu', type='div', limits=c(-20,20), name='Change in ASDR') +
labs(x='',y='') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
dev.off()
dc <- fread("C:/Users/ngraetz/Desktop/feb25_tables/allcause_25_64_decomp.csv")
dc[, V1 := NULL]
dc[fe=='residual', cov_name := 'Residual']
dc[fe=='year', cov_name := 'Year']
dc <- dc[, c('metro_region','contribution_mort','cov_name')]
ordered_covs_dc <- c(ordered_covs, 'Year', 'Residual')
dc[, cov_name := factor(cov_name, levels = ordered_covs_dc)]
dc_capped <- copy(dc)
dc_capped[contribution_mort >= 30, contribution_mort := 30]
dc_capped[contribution_mort <= -30, contribution_mort := -30]
pdf('C:/Users/ngraetz/Documents/repos/rwjf_counties/decomp_results.pdf', width=12, height=12)
ggplot() +
geom_tile(data=dc_capped,
aes(x=cov_name,
y=metro_region,
fill=contribution_mort),
color='black') +
geom_text(data=dc,
aes(x=cov_name,
y=metro_region,
label=round(contribution_mort,1))) +
scale_fill_distiller(palette = 'RdBu', type='div', limits=c(-30,30), name='Change in ASDR') +
labs(x='',y='') +
theme_minimal() +
theme(axis.text.x = element_text(angle = 45, hjust = 1))
dev.off()
